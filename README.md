# Spare Parts Magazine

## Функциональные возможности

Приложение реализует "Журнал запасных частей" с учетом срока службы, износа и планирования закупок. Основные модули:

- **Справочники**: Управление данными об оборудовании (наименование, количество в парке), запасных частях (наименование, срок использования, родительское оборудование, количество в оборудовании/на складе, срок закупки), авторемонтных мастерских (наименование, адрес) и типах замен (ремонт/плановая/внеплановая).
  - Поддержка добавления, просмотра и редактирования (для замен — через интерактивный редактор).

- **Учет замен**: Регистрация случаев замены частей в конкретном оборудовании, с указанием даты, типа замены и мастерской. Просмотр и редактирование в табличном виде с фильтрацией по оборудованию.

- **Расчет износа**: Автоматический анализ степени износа частей для выбранного оборудования. Зоны: зеленая (>25% остатка), желтая (10-25%), красная (<10%). Учет срока доставки при отсутствии на складе (критическая зона). Визуализация в виде бар-чарта с цветовой кодировкой (Plotly).

- **План закупок**: Расчет самой поздней даты инициации закупки, чтобы запасная часть прибыла вовремя (учет дат 10-го и 25-го числа следующего месяца + срок закупки). Поддержка расчета для одной или всех частей, с визуализацией timeline (Plotly) для обзора.

Данные инициализируются автоматически при запуске (минимум 5 записей в каждом справочнике), но могут быть расширены пользователем.

## Технологический стек

- **Backend**: FastAPI для REST API, SQLAlchemy для ORM-взаимодействия с SQLite (локальная БД без внешних зависимостей).
- **Frontend**: Streamlit для интерактивного UI с многостраничной навигацией, формами, таблицами (Pandas) и графиками (Plotly).
- **Валидация и схемы**: Pydantic для строгой типизации и валидации данных.
- **Логирование**: Встроенное с ротацией файлов для мониторинга.
- **Тестирование**: Pytest с mock'ами для backend (API endpoints, расчеты) и frontend (Streamlit AppTest для страниц).
- **Контейнеризация**: Docker и docker-compose для единого запуска (backend на порту 8000, frontend на 8501).
- **Дополнительно**: Healthcheck для backend, индексы в БД для производительности, обработка исключений на всех уровнях.

## Установка и запуск

1. **Требования**: Docker и docker-compose (версия 1.29+). Нет нужды в дополнительных установках — все в контейнере.

2. **Клонирование репозитория**:
   ```bash
   git clone <your-repo-url>
   cd <project-dir>
   ```

3. **Запуск**:
   ```bash
   docker-compose up --build
   ```
   - Backend будет доступен по `http://localhost:8000` (API docs: `/docs`).
   - Frontend — по `http://localhost:8501`.
   - БД сохраняется в volume `spare_parts_db` (файл `./spare_parts.db`).

4. **Остановка**: `Ctrl+C` или `docker-compose down`.

При первом запуске БД инициализируется с тестовыми данными. Если нужно сбросить — удалите volume или файл БД.

## Тестирование

Проект покрыт unit-тестами для backend (CRUD, расчеты) и integration-тестами для frontend (Streamlit страницы с mock API). Для запуска:

1. **Backend тесты**:
   ```bash
   docker exec -it <backend-container-id> pytest backend/tests
   ```
   (Или локально: `pip install -r requirements.txt && pytest backend/tests`).

2. **Frontend тесты**:
   ```bash
   docker exec -it <frontend-container-id> pytest frontend/tests
   ```
   (Аналогично локально).

Тесты используют in-memory DB и mock requests для изоляции.

## Дополнительные преимущества

- **Документация**: Встроенная в FastAPI (`/docs`), плюс логи в `app.log` для отладки.
- **Визуализация**: Графики Plotly для износа и плана закупок, таблицы Pandas для динамического просмотра.
- **Масштабируемость**: Легко добавить аутентификацию, миграции (Alembic) или перейти на PostgreSQL.
- **Edge-кейсы**: Обработаны (например, отсутствие замен — "Unknown" зона, прошлое end_date — ошибка).